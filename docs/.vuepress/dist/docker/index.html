<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | One Note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/note/favicon.ico">
    <meta name="description" content="记录学习和问题的文档">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.48e28c04.js" as="script"><link rel="preload" href="/note/assets/js/2.2624ee41.js" as="script"><link rel="preload" href="/note/assets/js/14.98d9cba9.js" as="script"><link rel="prefetch" href="/note/assets/js/10.c1802740.js"><link rel="prefetch" href="/note/assets/js/11.7a9e3ab6.js"><link rel="prefetch" href="/note/assets/js/12.3c430a13.js"><link rel="prefetch" href="/note/assets/js/13.0d2a6558.js"><link rel="prefetch" href="/note/assets/js/15.96fc4590.js"><link rel="prefetch" href="/note/assets/js/16.1a3aaee7.js"><link rel="prefetch" href="/note/assets/js/17.cc120f41.js"><link rel="prefetch" href="/note/assets/js/18.7f2a7f0f.js"><link rel="prefetch" href="/note/assets/js/19.f1bd563e.js"><link rel="prefetch" href="/note/assets/js/20.b71ec753.js"><link rel="prefetch" href="/note/assets/js/21.2388f2ea.js"><link rel="prefetch" href="/note/assets/js/22.ed38bb5f.js"><link rel="prefetch" href="/note/assets/js/23.53d90d88.js"><link rel="prefetch" href="/note/assets/js/24.57081aae.js"><link rel="prefetch" href="/note/assets/js/25.c0cfa11b.js"><link rel="prefetch" href="/note/assets/js/26.952fd65f.js"><link rel="prefetch" href="/note/assets/js/27.ac78fcc5.js"><link rel="prefetch" href="/note/assets/js/28.e0a607c6.js"><link rel="prefetch" href="/note/assets/js/29.7387e970.js"><link rel="prefetch" href="/note/assets/js/3.1a8c5a94.js"><link rel="prefetch" href="/note/assets/js/30.007fc4e6.js"><link rel="prefetch" href="/note/assets/js/31.8e3e9bd8.js"><link rel="prefetch" href="/note/assets/js/4.a149e6a8.js"><link rel="prefetch" href="/note/assets/js/5.1ddc52f8.js"><link rel="prefetch" href="/note/assets/js/6.4ea8b6af.js"><link rel="prefetch" href="/note/assets/js/7.4e0927be.js"><link rel="prefetch" href="/note/assets/js/8.11fb2ddd.js"><link rel="prefetch" href="/note/assets/js/9.af987736.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><img src="https://one-note.oss-cn-beijing.aliyuncs.com/common/logo.png" alt="One Note" class="logo"> <span class="site-name can-hide">One Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/boot/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/cloud/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/boot/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/cloud/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/docker/#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/docker/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/docker/#常用命令" class="sidebar-link">常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/docker/#启动类命令" class="sidebar-link">启动类命令</a></li><li class="sidebar-sub-header"><a href="/note/docker/#镜像类命令" class="sidebar-link">镜像类命令</a></li><li class="sidebar-sub-header"><a href="/note/docker/#容器命令" class="sidebar-link">容器命令</a></li></ul></li><li><a href="/note/docker/#容器数据卷" class="sidebar-link">容器数据卷</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/docker/#docker-file" class="sidebar-link">Docker File</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/docker/#保留字" class="sidebar-link">保留字</a></li><li class="sidebar-sub-header"><a href="/note/docker/#使用docker-file文件" class="sidebar-link">使用Docker File文件</a></li></ul></li><li><a href="/note/docker/#docker的网络模式" class="sidebar-link">docker的网络模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/docker/#compose容器编排" class="sidebar-link">compose容器编排</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>docker三要素：镜像、容器、仓库。</p> <ul><li>镜像：一个只读模板，用来创建docker容器</li> <li>容器：容器为镜像提供了一个安全、隔离的运行环境，容器可以启动、开始、停止、删除</li> <li>仓库：集中存放容器的地方</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">安装docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <h3 id="启动类命令"><a href="#启动类命令" class="header-anchor">#</a> 启动类命令</h3> <ul><li>systemctl start docker
<ul><li>启动docker</li></ul></li> <li>systemctl stop docker
<ul><li>停止docker</li></ul></li> <li>systemctl restart docker
<ul><li>重启docker</li></ul></li> <li>systemctl enable docker
<ul><li>开机自启动docker</li></ul></li> <li>systemctl status docker
<ul><li>查看docker服务状态信息</li></ul></li> <li>docker info
<ul><li>查看docker概要信息</li></ul></li> <li>docker --help
<ul><li>查看docker帮助</li></ul></li> <li>docker 命令 --help
<ul><li>查看命令帮助</li></ul></li></ul> <h3 id="镜像类命令"><a href="#镜像类命令" class="header-anchor">#</a> 镜像类命令</h3> <ul><li>docker images
<ul><li>列出docker中的镜像，-a显示本地所有镜像，-q只显示镜像ID</li></ul></li> <li>docker search 镜像
<ul><li>查看仓库中是否有该镜像</li></ul></li> <li>docker pull 镜像[:tag]
<ul><li>拉去镜像[指定版本]</li></ul></li> <li>docker system df
<ul><li>查看docker镜像/容器/数据卷所占空间</li></ul></li> <li>docker rmi 镜像
<ul><li>删除镜像，多个镜像以空格隔开</li></ul></li></ul> <h3 id="容器命令"><a href="#容器命令" class="header-anchor">#</a> 容器命令</h3> <ul><li>docker run 镜像
<ul><li>以该镜像添加一个容器实例
<ul><li>--name：为容器设置一个名字</li> <li>-i：以交互命令运行，通常与-t配合使用</li> <li>-t：重新生成一个终端</li> <li>-p [port]:[port]：指定端口映射</li> <li>-P：随机端口映射</li> <li>-d：以守护线程方式启动</li></ul></li></ul></li> <li>docker ps
<ul><li>列出docker运行的实例
<ul><li>-a：列出正在运行和曾经运行的容器</li> <li>-l：显示最近创建的容器</li> <li>-n：显示最近创建的n个容器</li> <li>-q：只显示容器编号</li></ul></li></ul></li> <li>docker restart 容器编号或名字
<ul><li>启动已经停止容器，或者重启容器</li></ul></li> <li>docker stop 容器编号或名字
<ul><li>停止容器</li></ul></li> <li>docker kill 容器编号或名字
<ul><li>强制停止容器</li></ul></li> <li>docker rm 容器编号或名字
<ul><li>删除已经停止的容器</li></ul></li> <li>docker logs 容器编号
<ul><li>查看容器实例运行日志</li></ul></li> <li>docker top 容器编号
<ul><li>相当于在容器内部执行top</li></ul></li> <li>docker inspect 容器编号
<ul><li>查看docker内部细节，json形式</li></ul></li> <li>docker exec -it 容器编号 bash
<ul><li>重新进入容器并打开一个伪终端，退出后不会关闭容器</li></ul></li> <li>docker cp 容器编号:文件路径&gt;拷贝目的地
<ul><li>拷贝容器中的文件到本地</li></ul></li> <li>docker export 容器编号 &gt; 文件名.tar
<ul><li>将容器导出为一个tar文件，对应import</li></ul></li> <li>cat 文件名.tar | docker import - 镜像用户名/镜像名字:镜像版本号
<ul><li>将tar文件导入生成一个镜像，保留之前容器的所有信息</li></ul></li> <li>docker commit -m=&quot;镜像描述信息&quot; -a=&quot;镜像作者&quot; 容器编号 要创建的镜像名称:镜像版本号
<ul><li>生成一个镜像文件</li></ul></li></ul> <h2 id="容器数据卷"><a href="#容器数据卷" class="header-anchor">#</a> 容器数据卷</h2> <p>容器数据卷能够持久化容器内的数据，在容器意外关闭时防止数据丢失，宿主机和容器能够共享数据卷内数据。运行一个带有数据卷的容器命令为：</p> <div class="language-docker extra-class"><pre class="language-docker"><code><span class="token comment"># ro read only 容器只能读</span>
<span class="token comment"># rw read write 容器可读写，默认规则</span>
docker run -it --privileged=true -v /宿主机绝对路径目录:容器内目录:[ro|rw] 镜像名称
</code></pre></div><p>可以通过<code>docker inspect 容器id或名字</code>查看数据卷是否映射正确。</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Mounts&quot;: [
    {
        &quot;Type&quot;: &quot;bind&quot;,
        &quot;Source&quot;: &quot;/temp/redis-data&quot;, 
        &quot;Destination&quot;: &quot;/temp/redis-data&quot;,
        &quot;Mode&quot;: &quot;&quot;,
        &quot;RW&quot;: true,
        &quot;Propagation&quot;: &quot;rprivate&quot;
    },
],
</code></pre></div><p>容器也可以继承其他容器的数据卷规则</p> <div class="language-docker extra-class"><pre class="language-docker"><code>docker run -d --name=u2 --privileged=true --volumes-form=夫容器 镜像名字
</code></pre></div><h2 id="docker-file"><a href="#docker-file" class="header-anchor">#</a> Docker File</h2> <p>docker file就是执行文件中的相关指令生成一个定制的镜像，进而简化配置镜像过程</p> <h3 id="保留字"><a href="#保留字" class="header-anchor">#</a> 保留字</h3> <ul><li>FROM
<ul><li>生成的镜像文件是基于哪一个镜像</li></ul></li> <li>MAINTAINER
<ul><li>镜像的作者信息</li></ul></li> <li>RUN
<ul><li>镜像构建时需要执行的命令，支持bash和exec，在build时执行</li></ul></li> <li>EXPOSE
<ul><li>当前容器监听的端口，要做端口映射需要使用-p</li></ul></li> <li>WORKDIR
<ul><li>镜像在容器内部的工作目录</li></ul></li> <li>ENV
<ul><li>在构建过程中设置环境变量</li></ul></li> <li>VOLUME
<ul><li>设置数据卷</li></ul></li> <li>ADD
<ul><li>将宿主机下的文件拷贝进镜像并且会自动处理url路径并解压</li></ul></li> <li>COPY
<ul><li>将文件copy进镜像目录</li></ul></li> <li>CMD
<ul><li>指定镜像创建容器后执行的命令，支持bash和exec两种格式，多个CMD指令只执行最后一个，docker run后的参数会覆盖CMD中的指令</li> <li>RUN指令在build时执行，CMD指令在run时执行</li></ul></li> <li>ENTRYPOINT
<ul><li>功能和CMD类似，但是有ENTRYPOINT时CMD只当传递参数使用，他们两个的组合会变成[ENTRYPOINT] [CMD]，此外ENTRYPOINT的执行的命令不会被docker run传入参数覆盖，但是还是会覆盖CMD命令，此时CMD类似默认参数</li></ul></li></ul> <h3 id="使用docker-file文件"><a href="#使用docker-file文件" class="header-anchor">#</a> 使用Docker File文件</h3> <p>默认不指定名字时，文件名字需要为Dockerfile。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#根据指定path下的docker file生成镜像并指定tag名字，path为.表示当前目录为build上下文</span>
<span class="token function">docker</span> build -t tag path
</code></pre></div><h2 id="docker的网络模式"><a href="#docker的网络模式" class="header-anchor">#</a> docker的网络模式</h2> <p>可以使用<code>docker network --help</code>来查看docker的网络信息。  docker常用的网络模式有bridge和host，区别在于bridge模式会在容器内创建虚拟的ip和端口，host直接使用主机的ip和端口。</p> <p>要设置docker的net模式可以在启动容器实例时通过<code>--net host</code>设置</p> <h2 id="compose容器编排"><a href="#compose容器编排" class="header-anchor">#</a> compose容器编排</h2> <p>docker compose能够管理多个docker实例，规定他们的启动顺序，一起启动，一起停止，方便管理大规模docker实例。具体可以参考官网用法<a href="https://docs.docker.com/get-started/08_using_compose/" target="_blank" rel="noopener noreferrer">compose用法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/11/2022, 12:21:34 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.48e28c04.js" defer></script><script src="/note/assets/js/2.2624ee41.js" defer></script><script src="/note/assets/js/14.98d9cba9.js" defer></script>
  </body>
</html>
