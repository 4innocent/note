<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>类加载器 | One Note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/note/favicon.ico">
    <meta name="description" content="记录学习和问题的文档">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.abf3d559.js" as="script"><link rel="preload" href="/note/assets/js/2.abf20492.js" as="script"><link rel="preload" href="/note/assets/js/9.af987736.js" as="script"><link rel="prefetch" href="/note/assets/js/10.ef068631.js"><link rel="prefetch" href="/note/assets/js/11.7a9e3ab6.js"><link rel="prefetch" href="/note/assets/js/12.d048b7f3.js"><link rel="prefetch" href="/note/assets/js/13.0d2a6558.js"><link rel="prefetch" href="/note/assets/js/14.957c9f4b.js"><link rel="prefetch" href="/note/assets/js/15.767a95a7.js"><link rel="prefetch" href="/note/assets/js/16.47e3542d.js"><link rel="prefetch" href="/note/assets/js/17.39bbe363.js"><link rel="prefetch" href="/note/assets/js/18.a3845ac9.js"><link rel="prefetch" href="/note/assets/js/19.25cbc001.js"><link rel="prefetch" href="/note/assets/js/20.1767e2b4.js"><link rel="prefetch" href="/note/assets/js/21.b3aac950.js"><link rel="prefetch" href="/note/assets/js/22.42ce2474.js"><link rel="prefetch" href="/note/assets/js/23.92d5aa45.js"><link rel="prefetch" href="/note/assets/js/24.787a6973.js"><link rel="prefetch" href="/note/assets/js/25.e99895e1.js"><link rel="prefetch" href="/note/assets/js/26.d470bd56.js"><link rel="prefetch" href="/note/assets/js/27.564cfa30.js"><link rel="prefetch" href="/note/assets/js/28.dfaf4702.js"><link rel="prefetch" href="/note/assets/js/29.b8e10ca9.js"><link rel="prefetch" href="/note/assets/js/3.1a8c5a94.js"><link rel="prefetch" href="/note/assets/js/30.007fc4e6.js"><link rel="prefetch" href="/note/assets/js/31.8e3e9bd8.js"><link rel="prefetch" href="/note/assets/js/4.a149e6a8.js"><link rel="prefetch" href="/note/assets/js/5.1ddc52f8.js"><link rel="prefetch" href="/note/assets/js/6.d52c9a9a.js"><link rel="prefetch" href="/note/assets/js/7.2451b6b5.js"><link rel="prefetch" href="/note/assets/js/8.11fb2ddd.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><img src="https://one-note.oss-cn-beijing.aliyuncs.com/common/logo.png" alt="One Note" class="logo"> <span class="site-name can-hide">One Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link router-link-active">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link router-link-active">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM相关</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/java/jvm/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/note/java/jvm/classloader.html" aria-current="page" class="active sidebar-link">类加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#类加载系统" class="sidebar-link">类加载系统</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#加载器分类" class="sidebar-link">加载器分类</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#类加载器的一些api" class="sidebar-link">类加载器的一些api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#getparent" class="sidebar-link">getParent</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#loadclass-string-name" class="sidebar-link">loadClass(String name)</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#findclass-string-name" class="sidebar-link">findClass(String name)</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#findloadedclass-string-name" class="sidebar-link">findLoadedClass(String name)</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#defineclass-string-name-byte-b-int-off-int-len" class="sidebar-link">defineClass(String name，byte[] b, int off, int len)</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#resolveclass-class-czz" class="sidebar-link">resolveClass(Class czz)</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#双亲委派机制" class="sidebar-link">双亲委派机制</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/classloader.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/note/java/jvm/runtimeandthread.html" class="sidebar-link">运行时数据区</a></li><li><a href="/note/java/jvm/jvmstack.html" class="sidebar-link">虚拟机栈</a></li><li><a href="/note/java/jvm/localmethod.html" class="sidebar-link">本地方法</a></li><li><a href="/note/java/jvm/heap.html" class="sidebar-link">堆</a></li><li><a href="/note/java/jvm/methodarea.html" class="sidebar-link">方法区</a></li><li><a href="/note/java/jvm/newinstance.html" class="sidebar-link">对象创建</a></li><li><a href="/note/java/jvm/stringtable.html" class="sidebar-link">字符串常量池</a></li><li><a href="/note/java/jvm/garbagecollection.html" class="sidebar-link">垃圾回收</a></li><li><a href="/note/java/jvm/cmdtools.html" class="sidebar-link">命令行工具</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java多线程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h1> <h2 id="类加载系统"><a href="#类加载系统" class="header-anchor">#</a> 类加载系统</h2> <p>类加载系统负责将类文件<code>.class</code>从本地或网络上加载到jvm的方法区中以便创建对象实例，加载系统只负责类文件的加载，文件是否能够运行有Execution Engine决定。<br> <code>.class</code>文件的加载主要由类加载<code>classloader</code>负责，加载过程分为三个阶段</p> <ol><li>loading阶段：将类加载至jvm内存中，加载完成会生成一个该类的<code>java.lang.Class</code>对象</li> <li>link阶段分为三步：
<ul><li>verify：验证阶段确保class类字节流文件符合jvm虚拟机规范</li> <li>prepare：为类变量分配内存空间并设置初始值，不包括final修饰的static属性，final修饰的属性在编译阶段已经分配空间（不一定赋值），类变量会分配在方法区中（元空间），实例属性则会在实例创建时分配在堆内存中</li> <li>resolve：将class文件中的符号引用转化为直接引用，</li></ul></li> <li>initialization阶段：初始化阶段就是执行构造类的构造器<code>&lt;clinit&gt;()</code>方法（jvm收集类变量的赋值动作和静态代码块自动生成），自动执行类静态属性赋值操作和静态代码块中的代码，此方法是线程安全的，如果有父类，jvm保证父类的该方法先执行然后再执行子类的<code>&lt;clinit&gt;()</code>方法，如果没有类变量和静态代码块则不会生成该方法。注意区分该方法和<code>&lt;init&gt;()</code>方法，<code>&lt;init&gt;()</code>方法是由根据构造类实例的构造器生成。</li></ol> <p><img src="/note/assets/img/classloader.17310489.png" alt="加载过程"></p> <h2 id="加载器分类"><a href="#加载器分类" class="header-anchor">#</a> 加载器分类</h2> <p>JVM支持两种类加载器：引导类加载器(bootstrap classloader)和自定义类加载器(user-defined classloader)，在jvm中一般将派生自ClassLoader的类加载器成为自定义类加载器，虚拟机自带三种类加载器</p> <ul><li>启动类加载器（bootstrap classloader）
<ul><li>启动类加载器不继承自ClassLoader，没有父类加载器，并且指定自己为扩展类加载器和系统类加载器的父类</li> <li>出于安全考虑启动类加载器只加载特定包名开头的类文件，如java、javax、sun等</li></ul></li> <li>扩展类加载器
<ul><li>派生于ClassLoader类</li> <li>从java.ext.dirs环境变量或者jdk安装的jre/lib/ext文件夹下加载，用户jar放在此处也会被加载</li> <li>父类加载器为引导类加载器</li></ul></li> <li>应用程序加载器（系统类加载器）
<ul><li>派生于ClassLoader，父类加载器为扩展类加载器</li> <li>负责加载classpath环境变量或系统属性java.class.path指定路径下的类库</li> <li>该加载器是默认的类加载器，一般情况java应用都是该类加载器加载，可由<code>ClassLoader.getSystemClassLoader()</code>获取</li></ul></li> <li>用户也可自定义类加载器以实现一些特殊功能</li></ul> <h2 id="类加载器的一些api"><a href="#类加载器的一些api" class="header-anchor">#</a> 类加载器的一些api</h2> <h3 id="getparent"><a href="#getparent" class="header-anchor">#</a> getParent</h3> <ul><li>返回该类加载器的超类</li></ul> <h3 id="loadclass-string-name"><a href="#loadclass-string-name" class="header-anchor">#</a> loadClass(String name)</h3> <ul><li>加载name类，返回一个java.lang.Class实例</li></ul> <h3 id="findclass-string-name"><a href="#findclass-string-name" class="header-anchor">#</a> findClass(String name)</h3> <ul><li>查找name类，返回一个java.lang.Class实例</li></ul> <h3 id="findloadedclass-string-name"><a href="#findloadedclass-string-name" class="header-anchor">#</a> findLoadedClass(String name)</h3> <ul><li>加载名为name的已加载类，返回一个java.lang.Class实例</li></ul> <h3 id="defineclass-string-name-byte-b-int-off-int-len"><a href="#defineclass-string-name-byte-b-int-off-int-len" class="header-anchor">#</a> defineClass(String name，byte[] b, int off, int len)</h3> <ul><li>从字节数组中加载一个类，名称为name，返回一个java.lang.Class实例</li></ul> <h3 id="resolveclass-class-czz"><a href="#resolveclass-class-czz" class="header-anchor">#</a> resolveClass(Class&lt;?&gt; czz)</h3> <ul><li>连接一个指定类</li></ul> <h2 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h2> <p>双亲委派机制可以防止人为覆盖系统启动类，具体流程为：</p> <ol><li>一个类加载器收到加载类请求，会转发给父类加载器</li> <li>如果父类加载器还有超类加载器则继续向上传递</li> <li>如果顶层加载器能完成加载，则加载完结束流程，否则依次向下传递加载任务直至加载成功，否则抛出异常</li></ol> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <ul><li>java中判断两个类对象是否一样需要满足两个条件
<ul><li>来自同一分类文件</li> <li>由同一个classloader加载</li></ul></li> <li>Class类对象会保存加载自己的类加载器的引用</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/java/jvm/" class="prev router-link-active">
        介绍
      </a></span> <span class="next"><a href="/note/java/jvm/runtimeandthread.html">
        运行时数据区
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.abf3d559.js" defer></script><script src="/note/assets/js/2.abf20492.js" defer></script><script src="/note/assets/js/9.af987736.js" defer></script>
  </body>
</html>
