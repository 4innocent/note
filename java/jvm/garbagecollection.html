<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>垃圾回收 | One Note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/note/favicon.ico">
    <meta name="description" content="记录学习和问题的文档">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.abf3d559.js" as="script"><link rel="preload" href="/note/assets/js/2.abf20492.js" as="script"><link rel="preload" href="/note/assets/js/19.25cbc001.js" as="script"><link rel="prefetch" href="/note/assets/js/10.ef068631.js"><link rel="prefetch" href="/note/assets/js/11.7a9e3ab6.js"><link rel="prefetch" href="/note/assets/js/12.d048b7f3.js"><link rel="prefetch" href="/note/assets/js/13.0d2a6558.js"><link rel="prefetch" href="/note/assets/js/14.957c9f4b.js"><link rel="prefetch" href="/note/assets/js/15.767a95a7.js"><link rel="prefetch" href="/note/assets/js/16.47e3542d.js"><link rel="prefetch" href="/note/assets/js/17.39bbe363.js"><link rel="prefetch" href="/note/assets/js/18.a3845ac9.js"><link rel="prefetch" href="/note/assets/js/20.1767e2b4.js"><link rel="prefetch" href="/note/assets/js/21.b3aac950.js"><link rel="prefetch" href="/note/assets/js/22.42ce2474.js"><link rel="prefetch" href="/note/assets/js/23.92d5aa45.js"><link rel="prefetch" href="/note/assets/js/24.787a6973.js"><link rel="prefetch" href="/note/assets/js/25.e99895e1.js"><link rel="prefetch" href="/note/assets/js/26.d470bd56.js"><link rel="prefetch" href="/note/assets/js/27.564cfa30.js"><link rel="prefetch" href="/note/assets/js/28.dfaf4702.js"><link rel="prefetch" href="/note/assets/js/29.b8e10ca9.js"><link rel="prefetch" href="/note/assets/js/3.1a8c5a94.js"><link rel="prefetch" href="/note/assets/js/30.007fc4e6.js"><link rel="prefetch" href="/note/assets/js/31.8e3e9bd8.js"><link rel="prefetch" href="/note/assets/js/4.a149e6a8.js"><link rel="prefetch" href="/note/assets/js/5.1ddc52f8.js"><link rel="prefetch" href="/note/assets/js/6.d52c9a9a.js"><link rel="prefetch" href="/note/assets/js/7.2451b6b5.js"><link rel="prefetch" href="/note/assets/js/8.11fb2ddd.js"><link rel="prefetch" href="/note/assets/js/9.af987736.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><img src="https://one-note.oss-cn-beijing.aliyuncs.com/common/logo.png" alt="One Note" class="logo"> <span class="site-name can-hide">One Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link router-link-active">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分类" class="dropdown-title"><span class="title">技术分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分类" class="mobile-dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link router-link-active">
  java
</a></li><li class="dropdown-item"><!----> <a href="/note/js/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/note/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/note/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架设施" class="dropdown-title"><span class="title">框架设施</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架设施" class="mobile-dropdown-title"><span class="title">框架设施</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-boot
</a></li><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">
  spring-cloud
</a></li><li class="dropdown-item"><!----> <a href="/note/flask/" class="nav-link">
  flask
</a></li><li class="dropdown-item"><!----> <a href="/note/egg/" class="nav-link">
  egg
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息中间件" class="dropdown-title"><span class="title">消息中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息中间件" class="mobile-dropdown-title"><span class="title">消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/rabbitmq/" class="nav-link">
  RabbitMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维相关" class="dropdown-title"><span class="title">运维相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维相关" class="mobile-dropdown-title"><span class="title">运维相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/note/jekins/" class="nav-link">
  jekins
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM相关</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/java/jvm/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/note/java/jvm/classloader.html" class="sidebar-link">类加载</a></li><li><a href="/note/java/jvm/runtimeandthread.html" class="sidebar-link">运行时数据区</a></li><li><a href="/note/java/jvm/jvmstack.html" class="sidebar-link">虚拟机栈</a></li><li><a href="/note/java/jvm/localmethod.html" class="sidebar-link">本地方法</a></li><li><a href="/note/java/jvm/heap.html" class="sidebar-link">堆</a></li><li><a href="/note/java/jvm/methodarea.html" class="sidebar-link">方法区</a></li><li><a href="/note/java/jvm/newinstance.html" class="sidebar-link">对象创建</a></li><li><a href="/note/java/jvm/stringtable.html" class="sidebar-link">字符串常量池</a></li><li><a href="/note/java/jvm/garbagecollection.html" aria-current="page" class="active sidebar-link">垃圾回收</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#垃圾检测算法" class="sidebar-link">垃圾检测算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#引用计数算法" class="sidebar-link">引用计数算法</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#可达性分析算法" class="sidebar-link">可达性分析算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#gc-roots" class="sidebar-link">GC Roots</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#finalization机制" class="sidebar-link">finalization机制</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#垃圾清除算法" class="sidebar-link">垃圾清除算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#标记-清除" class="sidebar-link">标记-清除</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#复制算法" class="sidebar-link">复制算法</a></li><li class="sidebar-sub-header"><a href="/note/java/jvm/garbagecollection.html#标记-压缩算法" class="sidebar-link">标记-压缩算法</a></li></ul></li></ul></li><li><a href="/note/java/jvm/cmdtools.html" class="sidebar-link">命令行工具</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java多线程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="垃圾回收"><a href="#垃圾回收" class="header-anchor">#</a> 垃圾回收</h1> <p>垃圾回收重点在堆上进行</p> <ul><li>频繁的回收年轻代</li> <li>较少回收老年代</li> <li>基本不懂永久代（元空间）</li></ul> <h2 id="垃圾检测算法"><a href="#垃圾检测算法" class="header-anchor">#</a> 垃圾检测算法</h2> <p>判断一个对象是否存活主要有两种算法：引用计数算法和可达性分析算法</p> <h3 id="引用计数算法"><a href="#引用计数算法" class="header-anchor">#</a> 引用计数算法</h3> <p>原理：每个对象保存一个整形的引用计数属性，当该对象被引用时加1，当引用失效时减1，当为0时表示不再被引用，可以被回收。</p> <ul><li>优点：
<ul><li>实现简单，垃圾对象便于识别</li> <li>判定效率高，回收没有延时</li></ul></li> <li>缺点：
<ul><li>需要单独的字段存储引用，增加内存消耗</li> <li>需要进行加减运算，增加负担</li> <li>最重要的是无法解决循环引用的问题</li></ul></li></ul> <h3 id="可达性分析算法"><a href="#可达性分析算法" class="header-anchor">#</a> 可达性分析算法</h3> <p>可达性分析算法同样具有实现简单、效率高的特点，而且还能解决循环引用的问题。该算法需要一个GC Roots作为根，java采用此种算法。<br>
基本思路：</p> <ol><li>以跟对象（GC Roots）为起始点，从上至下搜索被跟对象连接的对象是否可达</li> <li>使用该算法走过的路径称为引用链</li> <li>如果对象没有任何引用链连接则是不可达的，可以被回收，只有被跟对象直接或间接链接的对象才是存货对象</li></ol> <h2 id="gc-roots"><a href="#gc-roots" class="header-anchor">#</a> GC Roots</h2> <p>GC Roots包含以下对象：</p> <ul><li>虚拟机栈中引用的对象</li> <li>本地方法栈JNI引用的对象</li> <li>方法区中静态属性引用的对象</li> <li>方法区中常量引用的对象</li> <li>所有被同步锁持有的对象</li> <li>虚拟机内部持有的对象</li> <li>反映虚拟机内部情况的对象，如JMXBean等</li></ul> <div class="custom-block tip"><p class="custom-block-title">技巧</p> <p>如果一个指针，指向一个保存在堆中的对象，但是它自身不保存在堆中，那么它就是一个root。</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果使用可达性分析算法判断一个对象是否存活，则要保证分析工作是在一个一致性快照中进行，因此在GC时必须Stop The World</p></div> <h2 id="finalization机制"><a href="#finalization机制" class="header-anchor">#</a> finalization机制</h2> <p>对象在被回收前总会调用finalize()方法，在此方法中释放资源等操作。不要主动调用该方法，因为此方法会导致对象复活。<br>
有了finalization机制，对象则有三个状态：</p> <ol><li>可达状态</li> <li>可被复活状态</li> <li>不可达状态</li></ol> <h2 id="垃圾清除算法"><a href="#垃圾清除算法" class="header-anchor">#</a> 垃圾清除算法</h2> <p>当成功分离出可达对象和不可达对象，GC接下来的任务就是执行垃圾清除任务，释放掉无用的内存。目前常见的算法有：标记-清除算法、复制算法、标记-压缩算法。</p> <h3 id="标记-清除"><a href="#标记-清除" class="header-anchor">#</a> 标记-清除</h3> <p>执行过程：</p> <ul><li>标记：从GC Roots开始分析不可达对象</li> <li>清除：对堆内存从头开始进行线性搜索，如果对象没有被标位可达对象，内存就会被回收</li></ul> <p>缺点：</p> <ul><li>效率不高</li> <li>空闲内存分散</li> <li>GC需要暂停整个应用</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>内存清除是指记录该内存地址，需要使用时将对象存入该地址指向的内存。</p></div> <h3 id="复制算法"><a href="#复制算法" class="header-anchor">#</a> 复制算法</h3> <p>将内存空间分为两份，每次只使用其中一份。在GC时，将正在使用的内存中存活的对象复制到另外一份内存中，然后清除本内存所有对象，交换两份内存身份。<br>
优点：</p> <ul><li>不会出现内存碎片</li></ul> <p>缺点：</p> <ul><li>需要两倍空间</li> <li>对于G1这种拆分大量region的GC，复制而不是移动意味着需要维系各个region之间的引用关系，这个开销也不小</li></ul> <div class="custom-block warning"><p class="custom-block-title">特别的</p> <p>如果内存中垃圾对象特别多，复制算法需要复制的对象并不多，比如Young区的Survivor0和Survivor1。</p></div> <h3 id="标记-压缩算法"><a href="#标记-压缩算法" class="header-anchor">#</a> 标记-压缩算法</h3> <p>标记-压缩算法也可叫做标记-清除-压缩算法，它是对标记-清除算法的扩展。会将分散的对象移动到一起，使内存对齐。<br>
优点：</p> <ul><li>消除了标记-清除算法对象分散的缺点</li></ul> <p>缺点：</p> <ul><li>效率不高，低于复制算法</li> <li>移动对象时，如果对象被其他对象引用则还要调整引用的地址</li> <li>移动过程中需要STW</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/java/jvm/stringtable.html" class="prev">
        字符串常量池
      </a></span> <span class="next"><a href="/note/java/jvm/cmdtools.html">
        命令行工具
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.abf3d559.js" defer></script><script src="/note/assets/js/2.abf20492.js" defer></script><script src="/note/assets/js/19.25cbc001.js" defer></script>
  </body>
</html>
